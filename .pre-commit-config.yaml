---
# =============================================================================
# GOVERNANCE CHECKS (fail-fast)
#
# These run FIRST. Direct commits to main are forbidden — all changes must
# go through a pull request linked to a GitHub issue. If this hook fails:
#
#   1. Create a GitHub issue describing the change
#   2. Create a feature branch:  git checkout -b feat/<issue>-description
#   3. Commit to the feature branch, then open a PR with "Closes #<issue>"
#
# See CONTRIBUTING.md for the full workflow.
# =============================================================================
repos:
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v6.0.0
    hooks:
      - id: no-commit-to-branch
        name: "GOVERNANCE: never commit directly to main"
        args: ["--branch", "main"]

  # ===========================================================================
  # Repository-specific hooks (escape hatch)
  #
  # Runs scripts/pre-commit-local.sh if present and executable. Repos use
  # this for language-specific checks (ruff, eslint, tsc, etc.) that do not
  # belong in the universal config.
  # ===========================================================================
  - repo: local
    hooks:
      - id: local-hooks
        name: Repository-specific hooks
        entry: bash -c 'if [ -x scripts/pre-commit-local.sh ]; then scripts/pre-commit-local.sh; fi'
        language: system
        always_run: true
        pass_filenames: false

  # ===========================================================================
  # File size guard (no super-linter equivalent)
  # ===========================================================================
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v6.0.0
    hooks:
      - id: check-added-large-files
        args: ["--maxkb=1024"]

  # ===========================================================================
  # Super-Linter (manual stage — run with: pre-commit run super-linter --hook-stage manual)
  # Replaces individual yamllint, markdownlint, shellcheck, and actionlint hooks.
  # Requires Docker installed locally (~2GB image pull on first run).
  # ===========================================================================
  - repo: local
    hooks:
      - id: super-linter
        name: Super-Linter (local Docker)
        entry: bash -c 'docker run --rm -v "$(pwd):/tmp/lint" -w /tmp/lint -e RUN_LOCAL=true -e DEFAULT_BRANCH=main -e LINTER_RULES_PATH="." -e VALIDATE_JSON_PRETTIER=false -e VALIDATE_MARKDOWN_PRETTIER=false -e VALIDATE_YAML_PRETTIER=false ghcr.io/super-linter/super-linter:v8'
        language: system
        pass_filenames: false
        stages: [manual]

ci:
  autofix_prs: true
  autoupdate_schedule: weekly
  skip: [local-hooks, super-linter]
